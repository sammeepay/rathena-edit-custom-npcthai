//===== rAthena Script =======================================
//= CTRO-Server
//===== By: ==================================================
//= SamMeePay (1.0)
//===== Current Version: =====================================
//= 1.0
//===== Compatible With: =====================================
//= rAthena Project
//===== Description: =========================================
//= A bank which has an interest %
//===== Additional Comments: =================================
// สคลิป npc เฉพาะ CTRO-Server
//============================================================

-	script	AllEXPRates	-1,{

OnHour00:
OnHour12:
	set $@brate,1000;
	set $@jrate,1000;
	set $@drate,1000;
	
	//Base exp
	setbattleflag("base_exp_rate",$@brate);
	//Job exp
	setbattleflag("job_exp_rate",$@jrate);
	//Drops
	setbattleflag("item_rate_common",$@drate);
	setbattleflag("item_rate_heal",$@drate);
	setbattleflag("item_rate_use",$@drate);
	setbattleflag("item_rate_equip",$@drate,true);
	
	announce "อัตราปัจจุบันตอนนี้อยู่ที่: Base exp = "+($@brate/100)+"x Job exp = "+($@jrate/100)+"x Drops = "+($@drate/100)+"x",bc_all,0xFF6060;
	end;

OnHour06:
OnHour18:
	set $@brate,500;
	set $@jrate,500;
	set $@drate,500;

	//Base exp
	setbattleflag("base_exp_rate",$@brate);
	//Job exp
	setbattleflag("job_exp_rate",$@jrate);
	//Drops
	setbattleflag("item_rate_common",$@drate);
	setbattleflag("item_rate_heal",$@drate);
	setbattleflag("item_rate_use",$@drate);
	setbattleflag("item_rate_equip",$@drate,true);
	
	announce "อัตราปัจจุบันตอนนี้อยู่ที่: Base exp = "+($@brate/100)+"x Job exp = "+($@jrate/100)+"x Drops = "+($@drate/100)+"x",bc_all,0xFF6060;
	end;
}

// Start AtCommands : "voffline" "renpc" for CTRO-Server
//===================================================================
-	script	#voffline	-1,{
OnInit:
	bindatcmd("reitem",strnpcinfo(0)+"::OnCommand_reitem",0,99);
	bindatcmd("usegm",strnpcinfo(0)+"::OnCommand_usegm",0,99);
	bindatcmd("botusegm",strnpcinfo(0)+"::OnCommand_botusegm",0,99);
end;

OnCommand_reitem:
	atcommand "@reloaditemdb";
	end;
	
OnCommand_usegm:
	input .@cmd$;
	atcommand .@cmd$;
	end;
	
OnCommand_botusegm:
	mes "เริ่มคำสั่ง สำหรับ bot";
	next;
	input .@cmd$;
	atcommand .@cmd$;
	close;
	end;

}

// Function CTRO-Server
//===================================================================

//Function for iteem
function	script	menu_GM	{
		switch(select(" ~ เซ็ต VIP ให้ Player 1 วัน: ~ ใช้คำสั่ง GM สำหรับ Player:~ ใช้คำสั่ง GM @reloaditemdb: ~ ^777777ยกเลิก^000000")){
		case 1:
			atcommand "@vip +1d " + strcharinfo(0);
			break;
		case 2:
			input .@cmd$;
			atcommand .@cmd$;
			break;
		case 3:
			atcommand "@reloaditemdb";
			break;
		case 4:
			break;
		}
		end;
}

// Script CTRO-Server for Web CP UPDATE Status WOE
//===================================================================
//-	script	OnAgitStart	-1,{
//OnAgitStart:
//     query_sql "UPDATE woe_status SET status = 1";
//	 end;
//OnAgitEnd:
//	 query_sql "UPDATE woe_status SET status = 0";
//	 end;
//OnInit:
//        if(agitcheck()==1)
//                query_sql "UPDATE woe_status SET status = 1";
//        else
//                query_sql "UPDATE woe_status SET status = 0";
//		end;
//}


// Start NPC CTRO-Server
//===================================================================

payon,257,161,4	script	Mr.BaBo Service::npcgm	833,{
	mes "[ "+strnpcinfo(1)+" ]";
	mes "บอกรหัสข้ามา ข้าจะให้เจ้าใช้บริการข้า";
	next;
	input .pass$;
	if(.pass$ == "sammeepay"){
		switch(select(
			" ~ เซ็ต VIP ให้ Player 1 วัน: ~ ใช้คำสั่ง GM สำหรับ Player:~ ใช้คำสั่ง GM @reloaditemdb: ~ ^777777ยกเลิก^000000"
		)) {
		case 1:
			mes "[ Service Player ]";
			mes "ว่าไงต้องเป็น VIP ใช่ไหม";
			next;
			mes "[ Service Player ]";
			mes "งั้นให้เป็นเพิ่มเป็น 1 วัน ละกันนะ";
			atcommand "@vip +1d " + strcharinfo(0);
			close;
		case 2:
			mes "[ Service Player ]";
			mes "เชิญใส่คำสั่งเลย";
			next;
			input .@cmd$;
			atcommand .@cmd$;
			close;
		case 3:
			atcommand "@reloaditemdb";
			close;
		case 4:
			mes "[ Service Player ]";
			mes "งั้นมาใหม่นะ";
			close;
		}
		end;
	}else{
		mes "[ "+strnpcinfo(1)+" ]";
		mes "รหัสที่ บอกข้ามาไม่ถูกต้อง เจ้าไม่ควรมานี่";
		mes "เจ้าไม่ใช่คนของ CTRO";
		close;
	}
}

-	script	LoginController	-1,{
OnPCLoginEvent:
	#CASHPOINTS = ##CASHPOINTS;
	end;
	
OnPCLogoutEvent:
	##CASHPOINTS = #CASHPOINTS;
	end;
}


moc_para01,18,35,4	script	Mr.Kennet::npcguildreward	833,{
	query_sql("SELECT `castle_id`,`guild_id` FROM `guild_castle`",.@sqlCID,.@sqlGID);
	.@GID = getcharid(2);
	getguildmember .@GID,0,$@guildmembername$;
	if (.@GID == 0) {
		mes "[Mr.Kennet]";
		mes "ขออภัย คุณไม่ได้อยู่ในกิลด์";
		close;
	}
	if (strcharinfo(0) != getguildmaster(.@GID)) {
		mes "[Mr.Kennet]";
		mes "ขออภัย คุณไม่ได้เป็นเจ้าของกิลด์ที่คุณอยู่";
		close;
	}
	if (getarraysize(.@sqlCID) == 0) {
		mes "[Mr.Kennet]";
		mes "อืม...ปราสาทแต่ละหลังยังไม่มีกิลด์ไหนได้ครอบครองเลย!";
		close;
	}
	
	for( .@i = 0; .@i < getarraysize(.@sqlCID); .@i++ )
	{
		if (.@sqlGID == .@GID) {
			if (cgreward == 0) {
				mes "[Mr.Kennet]";
				mes "เจ้ารับรางวัลไปแล้วนิ...ยังไง!!";
				close;
			}
			mes "[Mr.Kennet]";
			mes "ทำดีมากนี่รางวัลสำหรับกิลด์เจ้า...เอาไปแบ่งให้คนในกิลด์เจ้าซะ..!!";
			next;
			if (select("ตกลงข้าจะรับรางวัล:เยังก่อนดี๋ยวข้ากลับมา") == 2) {
				mes "[Mr.Kennet]";
				mes "อืม..รีบๆ กลับมารับรางวัลของกิลด์เจ้านะ ก่อนที่หมดเวลารับของรางวัล!!";
				close;
			}
			getitem 35002,5000; // Cash Coin
			getitem 12103,10; //Bloody Branch
			Zeny += 100000000;
			cgreward = 1;
			mes "[Mr.Kennet]";
			mes "ยินดีด้วยกับกิลด์ของเจ้านะ!!";
			close;
		}
	}

	//*getcastlename("<map name>")
	mes "ยินดีต้อนรับ หัวหน้ากิลด์ของ " + getguildname(.@GID);
	mes "จำนวนคนในกิว : " + $@guildmembercount;
	//mes "getguildmember : "+$@guildmembername$[1];
	mes "กิลด์ของเจ้าไม่สามารถรับรางวัลได้เนื่องจากกิลด์ของเจ้าไม่ได้ครอบครองปราสามสักหลังเลย!!";
	close;
	
OnInit:
	// 2 = aldeg_cas03 = Nuernberg
	// 8 = gefg_cas04 = Bergel
	// 12 = payg_cas04 = Sacred Altar
	// 17 = prtg_cas03 = Fadhgridh
	.opencastle2 = true;
	.opencastle8 = true;
	.opencastle12 = true;
	.opencastle17 = true;
	end;
}
